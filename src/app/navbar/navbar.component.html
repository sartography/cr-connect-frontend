<ng-container *ngIf="!loading && user; else loadingMessage">
  <nav class="mat-elevation-z6" id="globalHeader">
    <a
      [routerLink]="['/']"
      class="site-title mat-title"
      id="nav_home"
      mat-button
    >
      <img alt="University of Virginia" class="logo" src="assets/logo/uva_rotunda.svg">
      {{title}}
    </a>
    <div class="flex-spacer"></div>

    <ng-container *ngIf="userIsAdmin">
      <div [ngClass]="{'viewing-as-user': userIsImpersonating}" fxLayout="row" fxLayoutGap=".3em">
        <mat-icon>preview</mat-icon>
        <div *ngIf="userIsImpersonating">Viewing as user {{this.user.uid}}</div>
        <div *ngIf="!userIsImpersonating">View as...</div>
        <div>
          <button mat-button [matMenuTriggerFor]="menu">
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item class="search-text" disabled [disableRipple]="true"> Search for Users </button>
            <button mat-menu-item [disableRipple]="true" (click)="$event.stopPropagation()">
            <div class="ldap-search">
              <form [formGroup]="form">
                <formly-form [form]="form" [fields]="fields" [model]="model" (modelChange)="viewAs(form.value)">
                </formly-form>
              </form>
            </div>
            </button>
          </mat-menu>
        </div>
      </div>
      <app-nav-links
        [links]="adminNavLinks"
        [ngClass]="{'viewing-as-user': userIsImpersonating}"
        id="adminToolbar"
      ></app-nav-links>
      <div class="flex-spacer"></div>
    </ng-container>

    <app-nav-links [links]="navLinks"></app-nav-links>
  </nav>
</ng-container>



<ng-template #loadingMessage>
  <nav class="mat-elevation-z6" id="loadingHeader">
    <div>
      <app-loading [size]="'sm'"></app-loading>
    </div>
  </nav>
</ng-template>
